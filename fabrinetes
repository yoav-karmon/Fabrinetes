#!/bin/bash
LOGFILE="fabrinetes_$(date +%Y-%m-%d).log"
SCRIPT_PATH="$(readlink -f "$0")"
TASKS_DIR="$(dirname "$SCRIPT_PATH")"

export HDLFORGE_ORIG_PATH="$(pwd)"

# Change to the tasks directory before running invoke
cd "$TASKS_DIR" || {
    echo "[!x!]  Failed to cd into $TASKS_DIR"
    echo "run update_repo_path correctly."
    exit 1
}

# Run invoke as if we were in that directory
echo "[$(date '+%Y-%m-%d %H:%M:%S')] \$ invoke -c tasks $*" | tee -a "$LOGFILE"
exec invoke -c tasks "$@" | tee -a "$LOGFILE"
